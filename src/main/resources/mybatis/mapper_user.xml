<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.wizwix.letsfutsal.mapper.UserMapper">
  <delete id="deleteUser" parameterType="long">
    delete
    from letsfutsal.user
    where user_id = #{userId}
  </delete>
  <insert id="insertUser" parameterType="io.github.wizwix.letsfutsal.dto.UserDTO" useGeneratedKeys="true" keyProperty="user.userId">
    insert into letsfutsal.user (email, password, nickname, gender, preferred_position, introduction)
    values (#{user.email}, #{user.password}, #{user.nickname}, #{user.gender}, #{user.preferredPosition}, #{user.introduction})
  </insert>
  <select id="selectTeamsByUserId" parameterType="long" resultType="io.github.wizwix.letsfutsal.dto.TeamDTO">
    select t.*
    from letsfutsal.team t
           join letsfutsal.team_member tm on t.team_id = tm.team_id
    where tm.user_id = #{userId}
  </select>
  <select id="selectNicknameByUserId" parameterType="long" resultType="string">
    select nickname
    from letsfutsal.user
    where user_id = #{userId}
  </select>
  <select id="selectTopUsersByGradeAndPosition" resultType="io.github.wizwix.letsfutsal.dto.UserDTO">
    select *
    from letsfutsal.user
    where 1=1
    <if test="grade != -1">
      and grade = #{grade}
    </if>
    <if test="position != null and position != ''">
      and preferred_position = #{position}
    </if>
    order by point desc
    limit 10
  </select>
  <select id="selectTopUsersByGender" resultType="io.github.wizwix.letsfutsal.dto.UserDTO">
    select *
    from letsfutsal.user
    where 1=1
    <if test="gender != null and gender != ''">
      and gender = #{gender}
    </if>
    <if test="grade != -1">
      and grade = #{grade}
    </if>
    order by point desc
    limit 10
  </select>
  <select id="selectUserByEmail" parameterType="string" resultType="io.github.wizwix.letsfutsal.dto.UserDTO">
    select *
    from letsfutsal.user
    where email = #{email}
  </select>
  <select id="selectUserById" parameterType="long" resultType="io.github.wizwix.letsfutsal.dto.UserDTO">
    select *
    from letsfutsal.user
    where user_id = #{userId}
  </select>
  <update id="updateGrade">
    update letsfutsal.user
    set grade = #{grade}
    where user_id = #{userId}
  </update>
  <update id="updatePoints">
    update letsfutsal.user
    set point = #{point}
    where user_id = #{userId}
  </update>
  <update id="updateUser" parameterType="io.github.wizwix.letsfutsal.dto.UserDTO">
    update letsfutsal.user
    set password           = #{user.password},
        nickname           = #{user.nickname},
        gender             = #{user.gender},
        preferred_position = #{user.preferredPosition},
        introduction       = #{user.introduction}
    where user_id = #{user.userId}
  </update>
</mapper>
